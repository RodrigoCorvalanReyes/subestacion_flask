<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Datos de Subestaci√≥n</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h1>Simulador de Datos de Subestaci√≥n</h1>
        
        <div class="main-layout">
            <div class="left-column">
                <!-- Panel de Control Principal -->
                <div class="status">
                    <div id="sim-status-indicator" class="stopped"></div>
                    <span id="sim-status-text">Estado: Detenido</span>
                </div>

                <!-- Contenedor para Eventos Activos -->
                <div id="active-events-container">
                    <h4>Eventos Activos:</h4>
                    <ul id="active-events-list">
                        <li>Ninguno</li>
                    </ul>
                </div>
            </div>
            
            <div class="right-column">
                <!-- Secci√≥n de Configuraci√≥n MQTT -->
                <div class="mqtt-manager">
                    <h2>Gestor de Conexiones MQTT</h2>
                    <div class="config-selector-wrapper">
                        <label for="config-selector">Seleccionar Configuraci√≥n Activa:</label>
                        <div class="selector-with-button">
                            <select id="config-selector"></select>
                            <button id="delete-config" class="delete-btn" title="Eliminar configuraci√≥n seleccionada">üóëÔ∏è</button>
                        </div>
                    </div>
                    <details class="add-config-details">
                        <summary>A√±adir Nueva Conexi√≥n</summary>
                        <form id="mqtt-form">
                            <div class="form-grid">
                                <input type="text" id="note" placeholder="Nota Descriptiva (ej: ThingsBoard Prod)" required>
                                <input type="text" id="broker" placeholder="Broker MQTT" required>
                                <input type="number" id="port" placeholder="Puerto" required>
                                <input type="text" id="topic" placeholder="T√≥pico" required>
                                <input type="text" id="username" placeholder="Token de Acceso / Usuario">
                                <textarea id="scratchpad-area" placeholder="Bloc de notas..."></textarea>
                            </div>
                            <button type="submit">Guardar Nueva Conexi√≥n</button>
                        </form>
                    </details>
                </div>

                <div class="controls">
                    <h2>Panel de Simulaci√≥n</h2>
                    <div class="interval-control">
                        <label for="interval-seconds">Intervalo de env√≠o (segundos):</label>
                        <input type="number" id="interval-seconds" value="15" min="1">
                    </div>
                    <div class="control-buttons">
                        <button id="start-sim">Iniciar Simulaci√≥n</button>
                        <button id="stop-sim">Detener Simulaci√≥n</button>
                    </div>
                </div>

                <!-- Disparador de Eventos -->
                <div class="event-controls">
                    <h2>Disparar Eventos de Falla</h2>
                    <div class="event-buttons">
                        <h3>Transformador T3</h3>
                        <div class="button-row">
                            <button class="event-btn" data-event="T3_overload">Sobrecarga</button>
                            <button class="event-btn" data-event="T3_cooling_fault">Falla de Refrigeraci√≥n</button>
                            <button class="event-btn" data-event="T3_transformer_temp_high">Temperatura Alta</button>
                        </div>
                        <div class="button-row">
                            <button class="event-btn" data-event="T3_oil_pressure_high">Presi√≥n de Aceite Alta</button>
                            <button class="event-btn" data-event="T3_oil_pressure_low">Presi√≥n de Aceite Baja</button>
                        </div>
                        <div class="button-row">
                            <button class="event-btn" data-event="T3_h2_high">Falla H2</button>
                            <button class="event-btn" data-event="T3_ch4_high">Falla CH4</button>
                            <button class="event-btn" data-event="T3_c2h6_high">Falla C2H6</button>
                            <button class="event-btn" data-event="T3_c2h2_high">Falla C2H2</button>
                        </div>
                        
                        <h3>Transformador T4</h3>
                        <div class="button-row">
                            <button class="event-btn" data-event="T4_overload">Sobrecarga</button>
                            <button class="event-btn" data-event="T4_cooling_fault">Falla de Refrigeraci√≥n</button>
                            <button class="event-btn" data-event="T4_transformer_temp_high">Temperatura Alta</button>
                        </div>
                        <div class="button-row">
                            <button class="event-btn" data-event="T4_oil_pressure_high">Presi√≥n de Aceite Alta</button>
                            <button class="event-btn" data-event="T4_oil_pressure_low">Presi√≥n de Aceite Baja</button>
                        </div>
                        <div class="button-row">
                            <button class="event-btn" data-event="T4_h2_high">Falla H2</button>
                            <button class="event-btn" data-event="T4_ch4_high">Falla CH4</button>
                            <button class="event-btn" data-event="T4_c2h6_high">Falla C2H6</button>
                            <button class="event-btn" data-event="T4_c2h2_high">Falla C2H2</button>
                        </div>
                        
                        <h3>Bater√≠as</h3>
                        <div class="button-row">
                            <button class="event-btn" data-event="BATTERY_fault">Falla del Cargador</button>
                            <button class="event-btn" data-event="BATTERY_temp_high">Temperatura Alta</button>
                        </div>
                        
                        <h3>L√≠nea de Agua</h3>
                        <div class="button-row">
                            <button class="event-btn" data-event="WATERLINE_pressure_high">Presi√≥n de Agua Alta</button>
                            <button class="event-btn" data-event="WATERLINE_pressure_low">Presi√≥n de Agua Baja</button>
                            <button class="event-btn" data-event="WATERLINE_flow_high">Flujo de Agua Alto</button>
                        </div>
                        <div class="button-row">
                            <button class="event-btn" data-event="WATERLINE_flow_low">Flujo de Agua Bajo</button>
                            <button class="event-btn" data-event="WATERLINE_flood">Inundaci√≥n</button>
                        </div>
                        
                        <h3>Subestaci√≥n</h3>
                        <div class="button-row">
                            <button class="event-btn" data-event="SUBSTATION_temp_high">Temperatura de Sala Alta</button>
                            <button class="event-btn" data-event="SUBSTATION_temp_low">Temperatura de Sala Baja</button>
                            <button class="event-btn" data-event="SUBSTATION_frequency_high">Frecuencia de Red Alta</button>
                            <button class="event-btn" data-event="SUBSTATION_frequency_low">Frecuencia de Red Baja</button>
                        </div>
                        
                    </div>
                    <div class="clear-all-container">
                        <button id="clear-all-events" class="clear-btn">Limpiar Todas las Fallas</button>
                    </div>
                </div>

                <!-- Tabla de Variables -->
                <div class="variable-table">
                    <h2>Tabla de Variables de Simulaci√≥n</h2>
                    <details>
                        <summary>Transformadores (T3 y T4)</summary>
                        <table>
                            <thead>
                                <tr>
                                    <th>Variable</th>
                                    <th>Unidad</th>
                                    <th>Descripci√≥n</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td><code>*_transformer_load_pct</code></td><td>%</td><td>Porcentaje de carga del transformador.</td></tr>
                                <tr><td><code>*_cooling_flow_lps</code></td><td>L/s</td><td>Caudal del sistema de refrigeraci√≥n.</td></tr>
                                <tr><td><code>*_top_oil_temp</code></td><td>¬∞C</td><td>Temperatura del aceite superior.</td></tr>
                                <tr><td><code>*_winding_temp</code></td><td>¬∞C</td><td>Temperatura de los devanados.</td></tr>
                                <tr><td><code>*_hot_spot_temp</code></td><td>¬∞C</td><td>Temperatura del punto m√°s caliente.</td></tr>
                                <tr><td><code>*_oil_pressure</code></td><td>bar</td><td>Presi√≥n del aceite diel√©ctrico.</td></tr>
                                <tr><td><code>*_ambient_temp</code></td><td>¬∞C</td><td>Temperatura ambiente.</td></tr>
                                <tr><td><code>*_ambient_humidity</code></td><td>%</td><td>Humedad ambiente.</td></tr>
                                <tr><td><code>*_fan_status</code></td><td>ON/OFF</td><td>Estado de los ventiladores.</td></tr>
                                <tr><td><code>*_pump_status</code></td><td>ON/OFF</td><td>Estado de la bomba de aceite.</td></tr>
                                <tr><td><code>*_tap_changer_position</code></td><td>-</td><td>Posici√≥n del cambiador de tomas.</td></tr>
                                <tr><td><code>*_h2_concentration_pct</code></td><td>%</td><td>Concentraci√≥n de Hidr√≥geno (H2).</td></tr>
                                <tr><td><code>*_ch4_concentration_pct</code></td><td>%</td><td>Concentraci√≥n de Metano (CH4).</td></tr>
                                <tr><td><code>*_c2h6_concentration_pct</code></td><td>%</td><td>Concentraci√≥n de Etano (C2H6).</td></tr>
                                <tr><td><code>*_c2h2_concentration_pct</code></td><td>%</td><td>Concentraci√≥n de Acetileno (C2H2).</td></tr>
                            </tbody>
                        </table>
                        <p><em>El prefijo <code>*</code> corresponde a <code>T3</code> o <code>T4</code>.</em></p>
                    </details>
                    <details>
                        <summary>Cargador de Bater√≠as</summary>
                        <table>
                            <thead>
                                <tr>
                                    <th>Variable</th>
                                    <th>Unidad</th>
                                    <th>Descripci√≥n</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td><code>charger_status</code></td><td>-</td><td>Estado del cargador (FLOAT/FAULT).</td></tr>
                                <tr><td><code>battery_voltage_V</code></td><td>V</td><td>Voltaje del banco de bater√≠as.</td></tr>
                                <tr><td><code>battery_current_A</code></td><td>A</td><td>Corriente de carga/descarga de bater√≠as.</td></tr>
                                <tr><td><code>battery_state_of_charge_pct</code></td><td>%</td><td>Porcentaje de carga de bater√≠as.</td></tr>
                                <tr><td><code>battery_temp_C</code></td><td>¬∞C</td><td>Temperatura del banco de bater√≠as.</td></tr>
                                <tr><td><code>battery_input_voltage_V</code></td><td>V</td><td>Voltaje de entrada AC del cargador.</td></tr>
                                <tr><td><code>battery_output_voltage_V</code></td><td>V</td><td>Voltaje de salida DC del cargador.</td></tr>
                            </tbody>
                        </table>
                    </details>
                    <details>
                        <summary>L√≠nea de Agua</summary>
                        <table>
                            <thead>
                                <tr>
                                    <th>Variable</th>
                                    <th>Unidad</th>
                                    <th>Descripci√≥n</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td><code>water_pressure_psi</code></td><td>psi</td><td>Presi√≥n en la l√≠nea de agua.</td></tr>
                                <tr><td><code>flowmeter_lps</code></td><td>L/s</td><td>Caudal medido en la l√≠nea de agua.</td></tr>
                                <tr><td><code>flood_sensor_status</code></td><td>0/1</td><td>Estado del sensor de inundaci√≥n (0=Seco, 1=Inundado).</td></tr>
                            </tbody>
                        </table>
                    </details>
                    <details>
                        <summary>Sensores Generales de la Subestaci√≥n</summary>
                        <table>
                            <thead>
                                <tr>
                                    <th>Variable</th>
                                    <th>Unidad</th>
                                    <th>Descripci√≥n</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td><code>room_temp_control</code></td><td>¬∞C</td><td>Temperatura de la sala de control.</td></tr>
                                <tr><td><code>grid_frequency_Hz</code></td><td>Hz</td><td>Frecuencia de la red el√©ctrica.</td></tr>
                                <tr><td><code>room_humidity</code></td><td>%</td><td>Humedad en la sala de control.</td></tr>
                            </tbody>
                        </table>
                    </details>
                </div>

                <!-- Registros -->
                <div class="logs">
                    <h2>Registros de la Simulaci√≥n</h2>
                    <pre id="log-output"></pre>
                </div>
            </div> <!-- End of right-column -->
        </div> <!-- End of main-layout -->
    </div>
    <script src="/static/script.js"></script>
</body>
</html>