<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Datos de Subestaci√≥n</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h1>Simulador de Datos de Subestaci√≥n</h1>
        
        <div class="main-layout">
            <div class="left-column">
                <!-- Panel de Control Principal -->
                <div class="status">
                    <div id="sim-status-indicator" class="stopped"></div>
                    <span id="sim-status-text">Estado: Detenido</span>
                </div>

                <!-- Contenedor para Eventos Activos -->
                <div id="active-events-container">
                    <h4>Eventos Activos:</h4>
                    <ul id="active-events-list">
                        <li>Ninguno</li>
                    </ul>
                </div>
            </div>
            
            <div class="right-column">
                <!-- Secci√≥n de Configuraci√≥n MQTT -->
                <div class="mqtt-manager">
                    <h2>Gestor de Conexiones MQTT</h2>
                    <div class="config-selector-wrapper">
                        <label for="config-selector">Seleccionar Configuraci√≥n Activa:</label>
                        <div class="selector-with-button">
                            <select id="config-selector"></select>
                            <button id="delete-config" class="delete-btn" title="Eliminar configuraci√≥n seleccionada">üóëÔ∏è</button>
                        </div>
                    </div>
                    <details class="add-config-details">
                        <summary>A√±adir Nueva Conexi√≥n</summary>
                        <form id="mqtt-form">
                            <div class="form-grid">
                                <input type="text" id="note" placeholder="Nota Descriptiva (ej: ThingsBoard Prod)" required>
                                <input type="text" id="broker" placeholder="Broker MQTT" required>
                                <input type="number" id="port" placeholder="Puerto" required>
                                <input type="text" id="topic" placeholder="T√≥pico" required>
                                <input type="text" id="username" placeholder="Token de Acceso / Usuario">
                                <textarea id="scratchpad-area" placeholder="Bloc de notas..."></textarea>
                            </div>
                            <button type="submit">Guardar Nueva Conexi√≥n</button>
                        </form>
                    </details>
                </div>

                <div class="controls">
                    <h2>Panel de Simulaci√≥n</h2>
                    <div class="interval-control">
                        <label for="interval-seconds">Intervalo de env√≠o (segundos):</label>
                        <input type="number" id="interval-seconds" value="15" min="1">
                    </div>
                    <div class="control-buttons">
                        <button id="start-sim">Iniciar Simulaci√≥n</button>
                        <button id="stop-sim">Detener Simulaci√≥n</button>
                    </div>
                </div>

                <!-- Disparador de Eventos -->
                <div class="event-controls">
                    <h2>Disparar Eventos de Falla</h2>
                    <div class="event-buttons">
                        <h3>Transformador T3</h3>
                        <div class="button-row">
                            <button class="event-btn" data-event="T3_cooling_fault">Falla de Refrigeraci√≥n</button>
                            <button class="event-btn" data-event="T3_c2h2_spike">Pico de Acetileno (Arco)</button>
                            <button class="event-btn" data-event="T3_overload">Sobrecarga</button>
                        </div>
                        <div class="button-row">
                            <button class="event-btn" data-event="T3_oil_pressure_high">Presi√≥n de Aceite Alta</button>
                            <button class="event-btn" data-event="T3_oil_pressure_low">Presi√≥n de Aceite Baja</button>
                            <button class="event-btn" data-event="T3_h2_high">Alta Concentraci√≥n de H2</button>
                        </div>
                        
                        <h3>Transformador T4</h3>
                        <div class="button-row">
                            <button class="event-btn" data-event="T4_cooling_fault">Falla de Refrigeraci√≥n</button>
                            <button class="event-btn" data-event="T4_c2h2_spike">Pico de Acetileno (Arco)</button>
                            <button class="event-btn" data-event="T4_overload">Sobrecarga</button>
                        </div>
                        <div class="button-row">
                            <button class="event-btn" data-event="T4_oil_pressure_high">Presi√≥n de Aceite Alta</button>
                            <button class="event-btn" data-event="T4_oil_pressure_low">Presi√≥n de Aceite Baja</button>
                            <button class="event-btn" data-event="T4_h2_high">Alta Concentraci√≥n de H2</button>
                        </div>
                        
                        <h3>Bater√≠as</h3>
                        <div class="button-row">
                            <button class="event-btn" data-event="BATTERY_fault">Falla del Cargador</button>
                            <button class="event-btn" data-event="BATTERY_temp_high">Temperatura Alta</button>
                        </div>
                        
                        <h3>L√≠nea de Agua</h3>
                        <div class="button-row">
                            <button class="event-btn" data-event="WATERLINE_pressure_high">Presi√≥n de Agua Alta</button>
                            <button class="event-btn" data-event="WATERLINE_pressure_low">Presi√≥n de Agua Baja</button>
                            <button class="event-btn" data-event="WATERLINE_flow_high">Flujo de Agua Alto</button>
                        </div>
                        <div class="button-row">
                            <button class="event-btn" data-event="WATERLINE_flow_low">Flujo de Agua Bajo</button>
                            <button class="event-btn" data-event="WATERLINE_flood">Inundaci√≥n (L√≠nea de Agua)</button>
                        </div>
                        
                        <h3>Subestaci√≥n</h3>
                        <div class="button-row">
                            <button class="event-btn" data-event="SUBSTATION_temp_high">Temperatura de Sala Alta</button>
                            <button class="event-btn" data-event="SUBSTATION_temp_low">Temperatura de Sala Baja</button>
                            <button class="event-btn" data-event="SUBSTATION_frequency_high">Frecuencia de Red Alta</button>
                            <button class="event-btn" data-event="SUBSTATION_frequency_low">Frecuencia de Red Baja</button>
                        </div>
                        
                        <div class="button-row">
                            <button id="clear-all-events" class="clear-btn">Limpiar Todas las Fallas</button>
                        </div>
                    </div>
                </div>

                <!-- Tabla de Variables -->
                <div class="variable-table">
                    <h2>Tabla de Variables de Simulaci√≥n</h2>
                    <details>
                        <summary>Transformadores (T3 y T4)</summary>
                        <table>
                            <thead>
                                <tr>
                                    <th>Variable</th>
                                    <th>Unidad</th>
                                    <th>Rango Nominal</th>
                                    <th>Rango en Falla</th>
                                    <th>Falla Asociada</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>*_transformer_load_pct</code></td>
                                    <td>%</td>
                                    <td><code>70.2 - 85.8</code></td>
                                    <td><code>104.5 - 115.5</code></td>
                                    <td>Sobrecarga</td>
                                </tr>
                                <tr>
                                    <td><code>*_cooling_flow_lps</code></td>
                                    <td>L/s</td>
                                    <td><code>38.8 - 41.2</code></td>
                                    <td><code>4.8 - 11.2</code></td>
                                    <td>Falla de Refrigeraci√≥n</td>
                                </tr>
                                <tr>
                                    <td><code>*_C2H2_ppm</code></td>
                                    <td>ppm</td>
                                    <td><code>0.42 - 0.58</code></td>
                                    <td><code>11.25 - 18.75</code></td>
                                    <td>Pico de Acetileno (Arco)</td>
                                </tr>
                                <tr>
                                    <td><code>*_top_oil_temp</code></td>
                                    <td>¬∞C</td>
                                    <td><code>71.08 - 80.25</code></td>
                                    <td><code>78.72 - 85.28</code></td>
                                    <td>Sobrecarga / Falla Refrigeraci√≥n</td>
                                </tr>
                                <tr>
                                    <td><code>*_winding_temp</code></td>
                                    <td>¬∞C</td>
                                    <td><code>84.02 - 93.8</code></td>
                                    <td><code>92.16 - 99.84</code></td>
                                    <td>Sobrecarga / Falla Refrigeraci√≥n</td>
                                </tr>
                                <tr>
                                    <td><code>*_hot_spot_temp</code></td>
                                    <td>¬∞C</td>
                                    <td><code>94.02 - 103.8</code></td>
                                    <td><code>102.16 - 109.84</code></td>
                                    <td>Sobrecarga / Falla Refrigeraci√≥n</td>
                                </tr>
                                <tr>
                                    <td><code>*_ambient_temp</code></td>
                                    <td>¬∞C</td>
                                    <td><code>22.5 - 27.5</code></td>
                                    <td>-</td>
                                    <td>-</td>
                                </tr>
                                <tr>
                                    <td><code>*_ambient_humidity</code></td>
                                    <td>%</td>
                                    <td><code>42.5 - 57.5</code></td>
                                    <td>-</td>
                                    <td>-</td>
                                </tr>
                                <tr>
                                    <td><code>*_oil_pressure</code></td>
                                    <td>bar</td>
                                    <td><code>1.42 - 1.58</code></td>
                                    <td><code>0.47 - 0.52</code> (baja) / <code>2.37 - 2.62</code> (alta)</td>
                                    <td>Presi√≥n de Aceite Baja / Alta</td>
                                </tr>
                                <tr>
                                    <td><code>*_H2_ppm</code></td>
                                    <td>ppm</td>
                                    <td><code>10.8 - 13.2</code></td>
                                    <td><code>18 - 22</code></td>
                                    <td>Alta Concentraci√≥n de H2</td>
                                </tr>
                                <tr>
                                    <td><code>*_fan_status</code></td>
                                    <td>-</td>
                                    <td><code>ON</code> si temp > 75¬∞C</td>
                                    <td><code>ON</code></td>
                                    <td>-</td>
                                </tr>
                                <tr>
                                    <td><code>*_pump_status</code></td>
                                    <td>-</td>
                                    <td><code>ON</code> si flujo > 10 L/s</td>
                                    <td><code>OFF</code></td>
                                    <td>Falla de Refrigeraci√≥n</td>
                                </tr>
                                <tr>
                                    <td><code>*_tap_changer_position</code></td>
                                    <td>-</td>
                                    <td><code>1 - 9</code> (aleatorio)</td>
                                    <td>-</td>
                                    <td>-</td>
                                </tr>
                            </tbody>
                        </table>
                        <p><em>El prefijo <code>*</code> corresponde a <code>T3</code> o <code>T4</code>.</em></p>
                    </details>
                    <details>
                        <summary>Cargador de Bater√≠as</summary>
                        <table>
                            <thead>
                                <tr>
                                    <th>Variable</th>
                                    <th>Unidad</th>
                                    <th>Rango Nominal</th>
                                    <th>Rango en Falla</th>
                                    <th>Falla Asociada</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>charger_status</code></td>
                                    <td>-</td>
                                    <td><code>FLOAT</code></td>
                                    <td><code>FAULT</code></td>
                                    <td>Falla del Cargador</td>
                                </tr>
                                <tr>
                                    <td><code>battery_voltage_V</code></td>
                                    <td>V</td>
                                    <td><code>122.5 - 127.5</code></td>
                                    <td><code>104.5 - 115.5</code></td>
                                    <td>Falla del Cargador</td>
                                </tr>
                                <tr>
                                    <td><code>battery_current_A</code></td>
                                    <td>A</td>
                                    <td><code>4.5 - 5.5</code></td>
                                    <td><code>-18 - -12</code></td>
                                    <td>Falla del Cargador</td>
                                </tr>
                                <tr>
                                    <td><code>battery_state_of_charge_pct</code></td>
                                    <td>%</td>
                                    <td><code>96.04 - 99.96</code></td>
                                    <td>-</td>
                                    <td>-</td>
                                </tr>
                                <tr>
                                    <td><code>battery_temp_C</code></td>
                                    <td>¬∞C</td>
                                    <td><code>28.5 - 31.5</code></td>
                                    <td><code>38 - 42</code></td>
                                    <td>Temperatura Alta</td>
                                </tr>
                            </tbody>
                        </table>
                    </details>
                    <details>
                        <summary>L√≠nea de Agua</summary>
                        <table>
                            <thead>
                                <tr>
                                    <th>Variable</th>
                                    <th>Unidad</th>
                                    <th>Rango Nominal</th>
                                    <th>Rango en Falla</th>
                                    <th>Falla Asociada</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>water_pressure_psi</code></td>
                                    <td>psi</td>
                                    <td><code>47.5 - 52.5</code></td>
                                    <td><code>28.5 - 31.5</code> (baja) / <code>66.5 - 73.5</code> (alta)</td>
                                    <td>Presi√≥n de Agua Baja / Alta</td>
                                </tr>
                                <tr>
                                    <td><code>flowmeter_lps</code></td>
                                    <td>L/s</td>
                                    <td><code>13.5 - 16.5</code></td>
                                    <td><code>4.75 - 5.25</code> (baja) / <code>23.75 - 26.25</code> (alta)</td>
                                    <td>Flujo de Agua Bajo / Alto</td>
                                </tr>
                                <tr>
                                    <td><code>flood_sensor_status</code></td>
                                    <td>-</td>
                                    <td><code>0</code> (Seco)</td>
                                    <td><code>1</code> (Inundado)</td>
                                    <td>Sensor de Inundaci√≥n</td>
                                </tr>
                            </tbody>
                        </table>
                    </details>
                    <details>
                        <summary>Sensores Generales de la Subestaci√≥n</summary>
                        <table>
                            <thead>
                                <tr>
                                    <th>Variable</th>
                                    <th>Unidad</th>
                                    <th>Rango Nominal</th>
                                    <th>Rango en Falla</th>
                                    <th>Falla Asociada</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>room_temp_control</code></td>
                                    <td>¬∞C</td>
                                    <td><code>21.34 - 22.66</code></td>
                                    <td><code>9.7 - 10.3</code> (baja) / <code>29.1 - 30.9</code> (alta)</td>
                                    <td>Temperatura de Sala Baja / Alta</td>
                                </tr>
                                <tr>
                                    <td><code>grid_frequency_Hz</code></td>
                                    <td>Hz</td>
                                    <td><code>49.95 - 50.05</code></td>
                                    <td><code>48.95 - 49.04</code> (baja) / <code>50.94 - 51.05</code> (alta)</td>
                                    <td>Frecuencia de Red Baja / Alta</td>
                                </tr>
                                <tr>
                                    <td><code>room_humidity</code></td>
                                    <td>%</td>
                                    <td><code>45 - 55</code></td>
                                    <td>-</td>
                                    <td>-</td>
                                </tr>
                            </tbody>
                        </table>
                    </details>
                </div>

                <!-- Registros -->
                <div class="logs">
                    <h2>Registros de la Simulaci√≥n</h2>
                    <pre id="log-output"></pre>
                </div>
            </div> <!-- End of right-column -->
        </div> <!-- End of main-layout -->
    </div>
    <script src="/static/script.js"></script>
</body>
</html>
