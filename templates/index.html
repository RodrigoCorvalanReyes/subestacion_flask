<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Datos de Subestación</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon.png">
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center mb-4">Simulador de Datos de Subestación</h1>

        <div class="row">
            <div class="col-lg-4">
                <div class="card mb-4">
                    <div class="card-header">
                        <h2>Panel de Simulación</h2>
                    </div>
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-3">
                            <div id="sim-status-indicator" class="stopped"></div>
                            <span id="sim-status-text" class="ms-2">Estado: Detenido</span>
                        </div>
                        <div class="mb-3">
                            <label for="interval-seconds" class="form-label">Intervalo (segundos):</label>
                            <input type="number" id="interval-seconds" class="form-control" value="1" min="1">
                        </div>
                        <div class="d-grid gap-2">
                            <button id="start-sim" class="btn btn-success">Iniciar Simulación</button>
                            <button id="stop-sim" class="btn btn-danger">Detener Simulación</button>
                        </div>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header">
                        <h2>Estado de Conexiones</h2>
                    </div>
                    <ul id="device-status-list" class="list-group list-group-flush">
                        <!-- Los estados se llenarán dinámicamente -->
                    </ul>
                </div>
            </div>

            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header">
                        <ul class="nav nav-tabs card-header-tabs" id="eventTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="t3-tab" data-bs-toggle="tab" data-bs-target="#t3" type="button" role="tab" aria-controls="t3" aria-selected="true">Transformador T3</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="t4-tab" data-bs-toggle="tab" data-bs-target="#t4" type="button" role="tab" aria-controls="t4" aria-selected="false">Transformador T4</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="battery-tab" data-bs-toggle="tab" data-bs-target="#battery" type="button" role="tab" aria-controls="battery" aria-selected="false">Baterías</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="substation-tab" data-bs-toggle="tab" data-bs-target="#substation" type="button" role="tab" aria-controls="substation" aria-selected="false">Subestación</button>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body tab-content" id="eventTabsContent">
                        <!-- Contenido de la Pestaña T3 -->
                        <div class="tab-pane fade show active" id="t3" role="tabpanel" aria-labelledby="t3-tab">
                            <!-- Grupos de botones para T3 -->
                        </div>
                        <!-- Contenido de la Pestaña T4 -->
                        <div class="tab-pane fade" id="t4" role="tabpanel" aria-labelledby="t4-tab">
                            <!-- Grupos de botones para T4 -->
                        </div>
                        <!-- Contenido de la Pestaña Baterías -->
                        <div class="tab-pane fade" id="battery" role="tabpanel" aria-labelledby="battery-tab">
                            <!-- Grupos de botones para Baterías -->
                        </div>
                        <!-- Contenido de la Pestaña Subestación -->
                        <div class="tab-pane fade" id="substation" role="tabpanel" aria-labelledby="substation-tab">
                            <!-- Grupos de botones para Subestación -->
                        </div>
                    </div>
                    <div class="card-footer text-center">
                        <button id="clear-all-events" class="btn btn-warning">Limpiar Todas las Fallas</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h2>Registros de la Simulación</h2>
                    </div>
                    <div class="card-body">
                        <pre id="log-output" class="form-control" style="height: 200px;"></pre>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h2>Descripción de Variables de Simulación</h2>
                    </div>
                    <div class="card-body">
                        <details class="mb-3">
                            <summary class="h5" style="cursor: pointer; padding: 10px; background-color: var(--surface-color-light); border-radius: 8px; margin-bottom: 10px;">Transformadores (T3 y T4)</summary>
                            <div class="table-responsive">
                                <table class="table table-striped table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Variable</th>
                                            <th>Unidad</th>
                                            <th>Rango Nominal</th>
                                            <th>Rango de Falla</th>
                                            <th>Falla Asignada</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><code>*_ambient_humidity</code></td>
                                            <td>%</td>
                                            <td>46.75 - 63.25</td>
                                            <td>27-33 (Baja) / 72-88 (Alta)</td>
                                            <td>Humedad Baja / Alta</td>
                                        </tr>
                                        <tr>
                                            <td><code>*_ambient_temp</code></td>
                                            <td>°C</td>
                                            <td>22.5 - 27.5</td>
                                            <td>N/A</td>
                                            <td>N/A</td>
                                        </tr>
                                        <tr>
                                            <td><code>*_acetileno_concentration_ppm</code></td>
                                            <td>ppm</td>
                                            <td>35 - 65</td>
                                            <td>425 - 575</td>
                                            <td>Falla Acetileno</td>
                                        </tr>
                                        <tr>
                                            <td><code>*_etano_concentration_ppm</code></td>
                                            <td>ppm</td>
                                            <td>75 - 125</td>
                                            <td>450 - 550</td>
                                            <td>Falla Etano</td>
                                        </tr>
                                        <tr>
                                            <td><code>*_metano_concentration_ppm</code></td>
                                            <td>ppm</td>
                                            <td>170 - 230</td>
                                            <td>720 - 880</td>
                                            <td>Falla Metano</td>
                                        </tr>
                                        <tr>
                                            <td><code>*_cooling_flow_lps</code></td>
                                            <td>L/s</td>
                                            <td>38.8 - 41.2</td>
                                            <td>16 - 24</td>
                                            <td>Falla de Refrigeración (30% menos)</td>
                                        </tr>
                                        <tr>
                                            <td><code>*_fan_status</code></td>
                                            <td>0/1</td>
                                            <td>0</td>
                                            <td>1</td>
                                            <td>Temp. aceite > 75°C</td>
                                        </tr>
                                        <tr>
                                            <td><code>*_hidrogeno_concentration_ppm</code></td>
                                            <td>ppm</td>
                                            <td>400 - 600</td>
                                            <td>1350 - 1650 (Alto) / 6 - 16 (Bajo)</td>
                                            <td>Falla Hidrógeno (Alto/Bajo)</td>
                                        </tr>
                                        <tr>
                                            <td><code>*_oil_pressure</code></td>
                                            <td>psi</td>
                                            <td>299.7 - 331.3</td>
                                            <td>498.5 - 551.1 / 98.9 - 109.4</td>
                                            <td>Presión Alta / Baja</td>
                                        </tr>
                                        <tr>
                                            <td><code>*_oil_temperature</code></td>
                                            <td>°C</td>
                                            <td>60 - 70</td>
                                            <td>70-90 (Alerta) / >= 90 (Alarma)</td>
                                            <td>Alerta/Alarma Temp. Aceite</td>
                                        </tr>
                                        <tr>
                                            <td><code>*_pump_status</code></td>
                                            <td>0/1</td>
                                            <td>0</td>
                                            <td>1</td>
                                            <td>Flujo refrig. > 10 L/s</td>
                                        </tr>
                                        <tr>
                                            <td><code>*_tap_changer_position</code></td>
                                            <td>int</td>
                                            <td>1-9</td>
                                            <td>N/A</td>
                                            <td>N/A</td>
                                        </tr>
                                        <tr>
                                            <td><code>*_transformer_load_pct</code></td>
                                            <td>%</td>
                                            <td>70.2 - 85.8</td>
                                            <td>104.5 - 115.5</td>
                                            <td>Sobrecarga</td>
                                        </tr>
                                        <tr>
                                            <td><code>*_transformer_temp</code></td>
                                            <td>°C</td>
                                            <td>(65 + Carga) ± 4%</td>
                                            <td>(85 + Carga) ± 3%</td>
                                            <td>Temperatura Alta</td>
                                        </tr>
                                        <tr>
                                            <td><code>*_winding_temp</code></td>
                                            <td>°C</td>
                                            <td>71.25 - 78.75</td>
                                            <td>80-95 (Alerta) / >= 95 (Alarma)</td>
                                            <td>Alerta/Alarma Temp. Devanado</td>
                                        </tr>
                                        <tr>
                                            <td><code>*_hot_spot_temp</code></td>
                                            <td>°C</td>
                                            <td>81.25 - 88.75</td>
                                            <td>N/A</td>
                                            <td>Temp. Punto Caliente (Temp. Devanado + 10°C)</td>
                                        </tr>
                                        <tr>
                                            <td><code>*_pump1_status</code></td>
                                            <td>0/1/2</td>
                                            <td>1 (Activo)</td>
                                            <td>0 (Falla) / 2 (Manual)</td>
                                            <td>Estado de la bomba 1</td>
                                        </tr>
                                        <tr>
                                            <td><code>*_pump2_status</code></td>
                                            <td>0/1/2</td>
                                            <td>T3: 1 (Activo), T4: 0 (SPEAR)</td>
                                            <td>T3: 0 (Falla) / 2 (Manual), T4: 1 (Activo si falla B1) / 2 (Manual)</td>
                                            <td>Estado de la bomba 2</td>
                                        </tr>
                                        <tr>
                                            <td><code>*_pump3_status</code></td>
                                            <td>0/1/2</td>
                                            <td>T3: 0 (SPEAR), T4: 0 (SPEAR)</td>
                                            <td>T3: 1 (Activo si fallan otras B) / 2 (Manual), T4: 1 (Activo si falla B1) / 2 (Manual)</td>
                                            <td>Estado de la bomba 3</td>
                                        </tr>
                                        <tr>
                                            <td><code>*_silicon_level_pct</code></td>
                                            <td>%</td>
                                            <td>90-100%</td>
                                            <td>N/A</td>
                                            <td>Nivel de silicona en transformador</td>
                                        </tr>
                                        <tr>
                                            <td><code>*_flowmeter_lps</code></td>
                                            <td>L/s</td>
                                            <td>13.5 - 16.5</td>
                                            <td>21.6-26.4 (Alto) / 4.5-5.5 (Bajo)</td>
                                            <td>Flujo General / Flujo Alto o Bajo (basado en salida)</td>
                                        </tr>
                                        <tr>
                                            <td><code>*_ambient_humidity</code></td>
                                            <td>%</td>
                                            <td>40 - 70</td>
                                            <td>27-33 (Baja) / 72-88 (Alta)</td>
                                            <td>Humedad Baja / Alta</td>
                                        </tr>
                                        <tr>
                                            <td><code>*_flood_sensor_status</code></td>
                                            <td>0/1</td>
                                            <td>0 (Seco)</td>
                                            <td>1</td>
                                            <td>Inundación</td>
                                        </tr>
                                        <tr>
                                            <td><code>*_water_pressure_psi</code></td>
                                            <td>PSI</td>
                                            <td>17.1 - 18.9</td>
                                            <td>N/A</td>
                                            <td>Presión Agua General (basado en salida)</td>
                                        </tr>
                                        <tr>
                                            <td><code>*_water_pressure_in_psi</code></td>
                                            <td>PSI</td>
                                            <td>17.1 - 18.9</td>
                                            <td>22.5 - 26.5 (Alta) / 6.8 - 7.2 (Baja)</td>
                                            <td>Presión de entrada agua</td>
                                        </tr>
                                        <tr>
                                            <td><code>*_water_pressure_out_psi</code></td>
                                            <td>PSI</td>
                                            <td>17.1 - 18.9</td>
                                            <td>25 - 35 (>20psi: presión máx. de salida excedida) / 6.8 - 7.2 (Baja)</td>
                                            <td>Presión de salida agua</td>
                                        </tr>

                                        <tr>
                                            <td><code>*_flowmeter_in_lps</code></td>
                                            <td>L/s</td>
                                            <td>13.5 - 16.5</td>
                                            <td>21.6 - 26.4 (Alto) / 4.5 - 5.5 (Bajo)</td>
                                            <td>Flujo de entrada agua</td>
                                        </tr>
                                        <tr>
                                            <td><code>*_flowmeter_out_lps</code></td>
                                            <td>L/s</td>
                                            <td>13.5 - 16.5</td>
                                            <td>9.45 - 11.55 (30% menor al flujo normal) / 21.6 - 26.4 (Alto) / 4.5 - 5.5 (Bajo)</td>
                                            <td>Flujo de salida agua</td>
                                        </tr>
                                        <tr>
                                            <td><code>*_water_in_oil_ppm</code></td>
                                            <td>ppm</td>
                                            <td>4 - 7</td>
                                            <td>7-11 (Alerta) / 11-15 (Falla)</td>
                                            <td>Nivel de Agua en Aceite</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </details>
                        
                        <details class="mb-3">
                            <summary class="h5" style="cursor: pointer; padding: 10px; background-color: var(--surface-color-light); border-radius: 8px; margin-bottom: 10px;">Cargador de Baterías</summary>
                            <div class="table-responsive">
                                <table class="table table-striped table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Variable</th>
                                            <th>Unidad</th>
                                            <th>Rango Nominal</th>
                                            <th>Rango de Falla</th>
                                            <th>Falla Asignada</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><code>battery_current_A</code></td>
                                            <td>A</td>
                                            <td>4.5 - 5.5</td>
                                            <td>17 - 23</td>
                                            <td>Corriente Alta</td>
                                        </tr>
                                        <tr>
                                            <td><code>battery_input_voltage_V</code></td>
                                            <td>V</td>
                                            <td>213.4 - 226.6</td>
                                            <td>180.5 - 199.5</td>
                                            <td>Voltaje de Entrada Bajo</td>
                                        </tr>
                                        <tr>
                                            <td><code>battery_state_of_charge_pct</code></td>
                                            <td>%</td>
                                            <td>96.04 - 99.96</td>
                                            <td>N/A</td>
                                            <td>N/A</td>
                                        </tr>
                                        <tr>
                                            <td><code>battery_temperature_C</code></td>
                                            <td>°C</td>
                                            <td>28.5 - 31.5</td>
                                            <td>38-42</td>
                                            <td>Temperatura Alta</td>
                                        </tr>
                                        <tr>
                                            <td><code>battery_output_voltage_V</code></td>
                                            <td>V</td>
                                            <td>122.5 - 127.5</td>
                                            <td>104.5 - 115.5</td>
                                            <td>Voltaje de Salida Bajo</td>
                                        </tr>
                                        <tr>
                                            <td><code>charger_status</code></td>
                                            <td>0/1</td>
                                            <td>0 (Normal)</td>
                                            <td>1</td>
                                            <td>Falla del Cargador</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </details>
                        
                        <details class="mb-3">
                            <summary class="h5" style="cursor: pointer; padding: 10px; background-color: var(--surface-color-light); border-radius: 8px; margin-bottom: 10px;">Sensores Generales de la Subestación</summary>
                            <div class="table-responsive">
                                <table class="table table-striped table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Variable</th>
                                            <th>Unidad</th>
                                            <th>Rango Nominal</th>
                                            <th>Rango de Falla</th>
                                            <th>Falla Asignada</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><code>grid_frequency_Hz</code></td>
                                            <td>Hz</td>
                                            <td>49.95 - 50.05</td>
                                            <td>50.94-51.05 / 48.95-49.04</td>
                                            <td>Frecuencia Alta / Baja</td>
                                        </tr>
                                        <tr>
                                            <td><code>room_humidity_control</code></td>
                                            <td>%</td>
                                            <td>45 - 55</td>
                                            <td>N/A</td>
                                            <td>N/A</td>
                                        </tr>
                                        <tr>
                                            <td><code>room_temperature_control</code></td>
                                            <td>°C</td>
                                            <td>21.34 - 22.66</td>
                                            <td>29.1-30.9 / 9.7-10.3</td>
                                            <td>Temperatura Alta / Baja</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </details>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/script.js"></script>
</body>
</html>
